<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>StatisticsCalculator.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">visitcounter</a> &gt; <a href="index.source.html" class="el_package">visitcounter.receiver</a> &gt; <span class="el_source">StatisticsCalculator.java</span></div><h1>StatisticsCalculator.java</h1><pre class="source lang-java linenums">package visitcounter.receiver;

import java.io.IOException;
import java.time.LocalDate;
import java.util.LinkedHashMap;
import java.util.List;
import java.util.Map;

<span class="nc" id="L9">public class StatisticsCalculator {</span>
	
	public static void calculateAverageFootfallsPerHourOverDay(List&lt;FootFallModel&gt; footFallRecords, IFootFallCsvWriter footFallCsvWriter) throws IOException {
		//List&lt;FootFallModel&gt; footFallRecords = FootFallRecordObjectStorer.getFootFallRecords();
<span class="fc" id="L13">		Map&lt;String,Integer&gt; countFootFallForEveryWorkingHour = getMapCountNoOfFootfallsForEveryWorkingHour(footFallRecords);</span>
<span class="fc" id="L14">		footFallCsvWriter.createWriter(UtilityReceiver.getCsvOutputFilePathFromProperties(&quot;filename1&quot;));</span>
		
<span class="fc" id="L16">		String [] column_names = {&quot;Working Hour&quot;, &quot;Average Foot Fall Per Hour&quot;};</span>
		
<span class="fc" id="L18">		footFallCsvWriter.writeColumnNamesToCsv(column_names);</span>
		
<span class="fc" id="L20">		countFootFallForEveryWorkingHour.forEach((k,v) -&gt; {</span>
<span class="fc" id="L21">			Double dailyFootfallPerHour = v.doubleValue()/30;</span>
<span class="fc" id="L22">			String [] data = {k, dailyFootfallPerHour.toString()};</span>
<span class="fc" id="L23">			footFallCsvWriter.writeRecordToCsv(data);</span>
<span class="fc" id="L24">		});</span>
		
<span class="fc" id="L26">		footFallCsvWriter.closeWriter();</span>
<span class="fc" id="L27">	}</span>
	
	public static void calculateDailyFootfallsOverWeek(List&lt;FootFallModel&gt; footFallRecords, IFootFallCsvWriter footFallCsvWriter) throws IOException {
<span class="fc" id="L30">		Map&lt;String,Integer&gt; countFootFallPerDayOfWeek = getMapCountFootFallsPerDayOfWeek(footFallRecords);</span>
<span class="fc" id="L31">		Map&lt;String,Integer&gt; countNoOfOccurencesOfDaysOfWeek = getMapCountNoOfOccurencesOfDaysOfWeek(footFallRecords);</span>

<span class="fc" id="L33">		footFallCsvWriter.createWriter(UtilityReceiver.getCsvOutputFilePathFromProperties(&quot;filename2&quot;));</span>
		
<span class="fc" id="L35">		String [] column_names = {&quot;Day of Week&quot;, &quot;Daily Foot Falls Over Week &quot;};</span>
		
<span class="fc" id="L37">		footFallCsvWriter.writeColumnNamesToCsv(column_names);</span>
		
<span class="fc" id="L39">		countFootFallPerDayOfWeek.forEach((k,v) -&gt; {</span>
<span class="fc" id="L40">			Double dailyFootfallPerDayOfWeek = v.doubleValue()/countNoOfOccurencesOfDaysOfWeek.get(k);</span>
<span class="fc" id="L41">			String [] data = {k.toString(), dailyFootfallPerDayOfWeek.toString()};</span>
<span class="fc" id="L42">			footFallCsvWriter.writeRecordToCsv(data);</span>
<span class="fc" id="L43">		});</span>
		
<span class="fc" id="L45">		footFallCsvWriter.closeWriter();</span>
<span class="fc" id="L46">	}</span>
		
	
	// Refractor to reduce cyclomatic complaxity of calculatePeakDailyFootfallsInParticularMonth
	private static String[] getPeakData(Map.Entry&lt;LocalDate,Integer&gt; record, int year, String peak_date, Integer peak_value) {
<span class="fc" id="L51">		String[] data = {peak_date, peak_value.toString()};</span>
<span class="pc bpc" id="L52" title="1 of 4 branches missed.">		if(record.getKey().getYear() == year &amp;&amp; record.getValue() &gt; peak_value) {</span>
<span class="fc" id="L53">				data[0] = record.getKey().toString();</span>
<span class="fc" id="L54">				data[1] = record.getValue().toString();</span>
			}
<span class="fc" id="L56">		return data;</span>
	}
	
	public static void calculatePeakDailyFootfallsInParticularMonth(int month, int year, List&lt;FootFallModel&gt; footFallRecords, IFootFallCsvWriter footFallCsvWriter) throws IOException {
<span class="fc" id="L60">		Map&lt;LocalDate,Integer&gt; countFootFallForEveryDate = getMapCountFootFallsForEveryDate(footFallRecords);</span>
		
<span class="fc" id="L62">		footFallCsvWriter.createWriter(UtilityReceiver.getCsvOutputFilePathFromProperties(&quot;filename3&quot;));</span>
		
<span class="fc" id="L64">		String [] column_names = {&quot;Date&quot;, &quot;Peak FootFall for current month&quot;};</span>
		
<span class="fc" id="L66">		footFallCsvWriter.writeColumnNamesToCsv(column_names);</span>
		
<span class="fc" id="L68">		Integer peak_value = 0;</span>
<span class="fc" id="L69">		String peak_date = &quot;2020/01/01&quot;;  //initializing with random value</span>
<span class="fc" id="L70">		String [] data = new String[2];</span>
<span class="fc bfc" id="L71" title="All 2 branches covered.">		for (Map.Entry&lt;LocalDate,Integer&gt; record : countFootFallForEveryDate.entrySet()) {</span>
<span class="fc bfc" id="L72" title="All 2 branches covered.">			if(record.getKey().getMonthValue() == month)</span>
			{
<span class="fc" id="L74">				data = getPeakData(record, year,peak_date, peak_value);</span>
<span class="fc" id="L75">				peak_date = data[0];</span>
<span class="fc" id="L76">				peak_value = Integer.parseInt(data[1]);</span>
				
			}
<span class="fc" id="L79">		}</span>
<span class="fc" id="L80">		footFallCsvWriter.writeRecordToCsv(data);</span>
<span class="fc" id="L81">		footFallCsvWriter.closeWriter();	</span>
<span class="fc" id="L82">	}</span>
	
	public static void calculatePeakDailyFootFallsInLastMonth(List&lt;FootFallModel&gt; footFallRecords, IFootFallCsvWriter footFallCsvWriter) throws IOException {
<span class="fc" id="L85">		int[] last_month_with_year = getLastMonthWithYear(footFallRecords);</span>
<span class="fc" id="L86">		calculatePeakDailyFootfallsInParticularMonth(last_month_with_year[0], last_month_with_year[1], footFallRecords, footFallCsvWriter);</span>
		
<span class="fc" id="L88">	}</span>
	
	
	private static Map&lt;LocalDate,Integer&gt; getMapCountFootFallsForEveryDate(List&lt;FootFallModel&gt; footFallRecords){
<span class="fc" id="L92">		Map&lt;LocalDate,Integer&gt; countFootFallForEveryDate = new LinkedHashMap&lt;&gt;();</span>
<span class="fc bfc" id="L93" title="All 2 branches covered.">		for(FootFallModel record: footFallRecords) {</span>
<span class="fc" id="L94">			countFootFallForEveryDate.merge(record.getDate(), 1, Integer::sum);</span>
<span class="fc" id="L95">		}</span>
<span class="fc" id="L96">		return countFootFallForEveryDate;</span>
		
	}
	
	private static Map&lt;String,Integer&gt; getMapCountFootFallsPerDayOfWeek(List&lt;FootFallModel&gt; footFallRecords){
<span class="fc" id="L101">		Map&lt;String,Integer&gt; countFootFallPerDay = new LinkedHashMap&lt;&gt;();</span>
<span class="fc bfc" id="L102" title="All 2 branches covered.">		for(FootFallModel record: footFallRecords) {</span>
<span class="fc" id="L103">			countFootFallPerDay.merge(record.getDate().getDayOfWeek().toString(), 1, Integer::sum);</span>
<span class="fc" id="L104">		}</span>
<span class="fc" id="L105">		return countFootFallPerDay;</span>
		
	}
	
	private static Map&lt;String,Integer&gt; getMapCountNoOfOccurencesOfDaysOfWeek(List&lt;FootFallModel&gt; footFallRecords){
<span class="fc" id="L110">		Map&lt;String,Integer&gt; countNoOfOccurencesOfDaysOfWeek = new LinkedHashMap&lt;&gt;();</span>
<span class="fc" id="L111">		String date = &quot;&quot;; </span>
<span class="fc bfc" id="L112" title="All 2 branches covered.">		for(FootFallModel record: footFallRecords) {</span>
<span class="fc bfc" id="L113" title="All 2 branches covered.">			if(!date.equals(record.getDate().toString())) {</span>
<span class="fc" id="L114">				countNoOfOccurencesOfDaysOfWeek.merge(record.getDate().getDayOfWeek().toString(), 1, Integer::sum);</span>
<span class="fc" id="L115">				date = record.getDate().toString();</span>
			}	
<span class="fc" id="L117">		}</span>
<span class="fc" id="L118">		return countNoOfOccurencesOfDaysOfWeek;</span>
		
	} 

	private static Map&lt;String,Integer&gt; getMapCountNoOfFootfallsForEveryWorkingHour(List&lt;FootFallModel&gt; footFallRecords){
<span class="fc" id="L123">		Map&lt;String,Integer&gt; countNoOfFootfallsForEveryWorkingHours = new LinkedHashMap&lt;&gt;();</span>
<span class="fc" id="L124">		int [] working_hour = UtilityReceiver.getWorkingHourOFaDay();</span>
<span class="fc" id="L125">		int opening_time = working_hour[0];</span>
<span class="fc" id="L126">		int closing_time = working_hour[1];</span>
<span class="fc bfc" id="L127" title="All 2 branches covered.">		for(int i = opening_time; i &lt;= closing_time; i++) {</span>
<span class="fc" id="L128">			countNoOfFootfallsForEveryWorkingHours.put(String.valueOf(i), 0);</span>
		}
		
<span class="fc bfc" id="L131" title="All 2 branches covered.">		for(FootFallModel record: footFallRecords) {</span>
			
<span class="fc" id="L133">			countNoOfFootfallsForEveryWorkingHours.merge(String.valueOf(record.getTime().getHour()), 1, Integer::sum);</span>
<span class="fc" id="L134">		}</span>
<span class="fc" id="L135">		return countNoOfFootfallsForEveryWorkingHours;</span>
		
	} 
	
	private static int[] getLastMonthWithYear(List&lt;FootFallModel&gt; footFallRecords) {
<span class="fc" id="L140">		FootFallModel last_record = footFallRecords.get(footFallRecords.size()-1);</span>
<span class="fc" id="L141">		int last_month_with_year[] = new int[2];</span>
<span class="fc" id="L142">		last_month_with_year[0] = last_record.getDate().getMonthValue();</span>
<span class="fc" id="L143">		last_month_with_year[1] = last_record.getDate().getYear();</span>
		
<span class="fc" id="L145">		return last_month_with_year;</span>
	}
		

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.2.201808211720</span></div></body></html>